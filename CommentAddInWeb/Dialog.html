<!DOCTYPE html>
<!-- Copyright (c) Microsoft. All rights reserved. Licensed under the MIT license.
4  See LICENSE in the project root for license information -->

<html>
<head>
    <title></title>
    <meta charset="utf-8" />
    <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js" type="text/javascript"></script>
    <script type="text/javascript" src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.2.1.min.js"></script>

    <!-- For the Office UI Fabric, go to http://aka.ms/office-ui-fabric to learn more. -->
    <link rel="stylesheet" href="https://appsforoffice.microsoft.com/fabric/2.1.0/fabric.min.css">
    <link rel="stylesheet" href="https://appsforoffice.microsoft.com/fabric/2.1.0/fabric.components.min.css">
    <script src="Home.js"></script>
    <script>
        Office.initialize = function () {
            $('#button1').click(one);
            $('#button2').click(two);
        };

        function one() {
            Word.run(function (context) {
                // Create a proxy object for the document body.
                var body = context.document.body;
                // Queue a commmand to get the OOXML contents of the body.
                var bodyOOXML = body.getOoxml();

                // Synchronize the document state by executing the queued commands
                // and return a promise to indicate task completion.
                return context.sync()
                    .then(function () {
                        var currentOOXML = "";
                        currentOOXML = bodyOOXML.value;
                        comment(currentOOXML);
                    });
            })
                .catch(errorHandler);

            //Office.context.ui.messageParent("Picked 1");
        }
        function comment(ooXml) {

            //$.get("/api/comments", function (data) {
            //    showNotification("result",data);
            //});
            $.ajax({
                type: "POST",
                url: "/api/comments/convertOOXmlToComments",
                // The key needs to match your method's input parameter (case-sensitive).
                data: JSON.stringify(ooXml),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    $("#jsGrid").jsGrid({

                        height: "500px",
                        width: "100%",
                        filtering: true,
                        sorting: true,
                        paging: true,
                        autoload: true,
                        pageSize: 10,
                        pageButtonCount: 5,

                        data: data,
                        fields: [
                            { name: "Id", type: "number", width: 150, validate: "required" },
                            { name: "CommentedText", type: "text", width: 200 },
                            { name: "Date", type: "date", width: 100 },
                            { name: "Author", type: "text", width: 200 },
                            { name: "Text", type: "text", width: 200 },
                        ]
                    });
                },
                failure: function (errMsg) {
                    showNotification("result", data);
                }
            });
        }

        function two() {
            Office.context.ui.messageParent("Picked 2");
        }
        function displaySelectedText() {
            Office.context.document.getSelectedDataAsync(Office.CoercionType.Text,
                function (result) {
                    if (result.status === Office.AsyncResultStatus.Succeeded) {
                        showNotification('The selected text is:', '"' + result.value + '"');
                    } else {
                        showNotification('Error:', result.error.message);
                    }
                });
        }

        //$$(Helper function for treating errors, $loc_script_taskpane_home_js_comment34$)$$
        function errorHandler(error) {
            // $$(Always be sure to catch any accumulated errors that bubble up from the Word.run execution., $loc_script_taskpane_home_js_comment35$)$$
            showNotification("Error:", error);
            console.log("Error: " + error);
            if (error instanceof OfficeExtension.Error) {
                console.log("Debug info: " + JSON.stringify(error.debugInfo));
            }
            Office.context.ui.messageParent(JSON.stringify(error.debugInfo));

        }

        // Helper function for displaying notifications
        function showNotification(header, content) {
            $("#notification-header").text(header);
            $("#notification-body").text(content);
            messageBanner.showBanner();
            messageBanner.toggleExpansion();
        }

    </script>
</head>
<body>
    <p class="ms-font-xxl ms-fontColor-neutralSecondary ms-fontWeight-semilight">Pick a number</p>
    <button class="ms-Button ms-Button--primary" id="button1">
        <span class="ms-Button-icon"><i class="ms-Icon ms-Icon--plus"></i></span>
        <span class="ms-Button-label" id="button1-text">1</span>
        <span class="ms-Button-description" id="button1-desc">Number 1</span>
    </button>
    <button class="ms-Button ms-Button--primary" id="button2">
        <span class="ms-Button-icon"><i class="ms-Icon ms-Icon--plus"></i></span>
        <span class="ms-Button-label" id="button2-text">2</span>
        <span class="ms-Button-description" id="button2-desc">Number 2</span>
    </button>
</body>
</html>
